{% extends 'manuscripts/manuscripts_dummy_base.html' %}
{% load thumbnail %}
{% load xml_operations %}

{% block heads %}
{% endblock %}

{% block source_pages %}
{% endblock %}

{% block content %}
<div class="panel panel-default">
	<div class="panel-body">
		<div class="media">
			{% if page_obj.manuscript.frontcover %}
		 	<div class="media-left">
				{% thumbnail page_obj.manuscript.frontcover "67x100" crop="98% 0%" as thum %}
				<img src="{{ thum.url }}" width="{{ thum.width }}" height="{{ thum.height }}">
		    	{% endthumbnail %}
		  	</div>
		 	{% endif %}
			<div class="media-body">
			    <h4 class="media-heading">{{ object.title }}</h4>
			    	{{ page_obj }} {% if page_obj.jja %}; JJA {{ page_obj.jja }}{% endif %}
			    	<br/>
			    	{{ page_obj.specific_pageinfo }}
			    	{% if found_notes %}
			    	<div class="media">
			  			<div class="media-left">
			  				<span class="glyphicon glyphicon-list-alt"></span>
			  			</div>
			  			<div class="media-body">
			    			<h4 class="media-heading">Notes traced <span class="badge">{{ counted_found_notes }}</span></h4>
					    	{% for note in found_notes %}
					    		<a href="">{{ note.notepage }} {{ note.notejj }}</a><br/>
					    	{% endfor %}
					    </div>
					</div>
					{% endif %}
			</div>
		</div>
	</div>
</div>

</div>
<!-- page wrap closed and open gallery wrap -->
<div class="gallery-wrap">
	<div class="tabnav page-gallery">

		<div class="gallery_toolbar">
			<div class="btn-group" data-toggle="buttons">
				<a id="page_button" class="btn btn-default notred neverred" href="#page-view" aria-controls="home" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-file"></span></a>
				<a id="zoom_button" class="btn btn-default notred neverred" href="#page-view" aria-controls="profile" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-zoom-in"></span></a>
				<a class="btn btn-default notred neverred nohover" style="cursor: default;">~</a>
				<a id="transcribe_button" class="btn btn-default notred neverred" href="#transcription-view" aria-controls="profile" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-text-height"></span></a>
				<a id="references_button" class="btn btn-default notred neverred" href="#referenced_transcription-content"><span class="glyphicon glyphicon-list-alt"></span></a>
				<a class="btn btn-default notred neverred" href="#" data-toggle="modal" data-target="#infomodal"><span class="glyphicon glyphicon-question-sign"></span></a>
			</div>
		</div>

		{% with page_obj.manuscript as object %}
		{% include 'manuscripts/includes/infomodal.html' %}
		{% endwith %}

		<div class="tab-content detail_page">
			<div id="page-view" role="tabpanel" class="tab-pane active">
			{% if page_obj.image|is_portrait %}
				{% thumbnail page_obj.image "x700" as im %}
					<img id="source_page" alt="" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" data-zoom-image="{{ MEDIA_URL }}{{ page_obj.image }}">
				{% endthumbnail %}
			{% else %}
				{% thumbnail page_obj.image "1000" as im %}
					<img id="source_page" alt="" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" data-zoom-image="{{ MEDIA_URL }}{{ page_obj.image }}">
				{% endthumbnail %}
			{% endif %}
			</div>
			<div id="transcription-view" role="tabpanel" class="tab-pane">
				<div class="page1" style="width:500px; overflow: auto;direction:rtl;">
			{% if page_obj.image|is_portrait %}
				{% thumbnail page_obj.image "500" as im %}
					<img id="transcription_page" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" data-zoom-image="{{ MEDIA_URL }}{{ page_obj.image }}">
				</div>
				<div id="transcription" class="panel paneldefault">
				<div style="min-height:{{ im.height }}px;">
				{% endthumbnail %}
			{% else %}
				{% thumbnail page_obj.image "1000" as im %}
					<img id="transcription_page" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" data-zoom-image="{{ MEDIA_URL }}{{ page_obj.image }}">
				</div>
				<div class="transcription singletranscription panel paneldefault">
				<div style="min-height:{{ im.height }}px;">
				{% endthumbnail %}
			{% endif %}
					<div class="panel-body">
						<div class="transcription-content">
							{{ page_obj.transcription|safe }}
						</div>
						<div class="referenced_transcription-content" style="display: none;">
							{% show_ref_tag page_obj.transcription %}
						</div>
					</div>
				</div>
				</div>
			</div>
		</div>
		<div class="page-row-well well well-sm">
			{% if previous_page %}
				<div class="page-row">
				{% thumbnail previous_page.image "x100" as previous_thum %}
					<a href="{% url 'manuscriptpage_detail' collectionslug=object.slug manuscriptpage=previous_page.page_number|slugify %}" title="{{ previous_page.page_number }}">
						<img class="thumbnail" src="{{ previous_thum.url }}" width="{{ previous_thum.width }}" height="{{ previous_thum.height }}">
					</a>
				{% endthumbnail %}
				</div>
			{% endif %}
				<div class="page-row">
				{% thumbnail page_obj.image "x100" as actual_thum %}
					<img class="thumbnail active" src="{{ actual_thum.url }}" width="{{ actual_thum.width }}" height="{{ actual_thum.height }}">
				{% endthumbnail %}
				</div>
			{% if next_page %}
				<div class="page-row">
				{% thumbnail next_page.image "x100" as next_thum %}
					<a href="{% url 'manuscriptpage_detail' collectionslug=object.slug manuscriptpage=next_page.page_number|slugify %}" title="{{ next_page.page_number }}" >
						<img class="thumbnail" src="{{ next_thum.url }}" width="{{ next_thum.width }}" height="{{ next_thum.height }}">
					</a>
				{% endthumbnail %}
				</div>
			{% endif %}
		</div>

	</div>
</div>
{% endblock %}

{% block finaljavascript %}
<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
</script>
<script>
var button = $('#references_button');
var referencesActive = false;

button.on('click', function() {
	referencesActive = !referencesActive;

	if (referencesActive) {
		$('.transcription-content').hide();
		$('.referenced_transcription-content').show();
	} else {
		$('.referenced_transcription-content').hide();
		$('.transcription-content').show();
	}
});

</script>
<script src="{{ STATIC_URL }}JJDLP/js/jquery.elevatezoom.js" type="text/javascript"></script>
<script>
var transcribebutton = $('#transcribe_button');
var zoombutton = $('#zoom_button');
var image = $('#source_page');

var zoomActive = false;

transcribebutton.on('click', function () {
	zoomActive = false;

	$.removeData(image, 'elevateZoom');
	$('.zoomContainer').remove();
});

zoombutton.on('click', function () {

	zoomActive = !zoomActive;

	if (zoomActive) {
		image.elevateZoom({
			scrollZoom: true,
			constrainType:"height",
			constrainSize:274,
			zoomType: "lens",
			containLensZoom: true,
			cursor: 'pointer',
			galleryActiveClass: "active"
		});
	} else {
		$.removeData(image, 'elevateZoom');
		$('.zoomContainer').remove();
	}
});
</script>
{% endblock %}