{% extends "library/library_dummy_base.html" %}
{% load humanize %}
{% load thumbnail %}
{% load resolve_certainty %}

{% block heads %}
<script src="{{ STATIC_URL }}JJDLP/js/jquery-1.11.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script type="text/javascript" src="{{ STATIC_URL }}library/js/unfold.js"></script>
<link href="http://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.3/fotorama.css" rel="stylesheet">
<script src="http://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.3/fotorama.js"></script>
{% endblock %}

{% block body_title %}{% endblock %}
{% block sort_fields %} {% endblock %}

{% block content %}
<div id="detail">
	{% block source_pages %}
		{% if coverimages %}
			<table id="cover" style="border:none !important;">
			<tr><td>
			<div id="cover_fotorama" class="fotorama">
			{% for cover in coverimages %}
				{% thumbnail cover.image "360x550" crop="96% 40%" as im %}
					<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" style="position:absolute;top:0px;left:-550px;cursor:move;">
				{% endthumbnail %}
			{% endfor %}
			</div>
			</td></tr>
			</table>
		{% else %}
			<table id="cover">
				<tr>
					<td>
						<figure>
						<img id="ghost_page" alt="" src="{{ MEDIA_URL }}JJDLP/images/torn_paper.png">
						<figcaption>The front cover has vanished...</figcaption>
						</figure>
					</td>
				</tr>
			</table>
		{% endif %}
	{% endblock %}
	<div class="source_info">
		<div class="short_sourceinfo">
			{% block source_info_cover %}{% endblock %}
			<table id="source_info" width="60%">
				<tr>
					<td><strong>{{ object.title }}</strong> | <a href="{% url 'haystack_search' %}?q={{ object.get_authors }}">{{ object.get_authors }}</a></td>
				</tr>
				<tr>
					<td><a href="{% url 'haystack_search' %}?q={{ object.publication_date }}">{{ object.publication_date }}</a> | {{ object.publisher }}</td>
				</tr>
				<tr>
					<td style="display:inline-block;">
						<a href="{% url 'haystack_search' %}?q={{ object.source_type }}"><img id="thumbnail" alt="" src="{{ STATIC_URL }}{% ifequal object.source_type 'book' %}JJDLP/images/Book_pic.png{% else %}JJDLP/images/News_pic.png{% endifequal %}" height="30" style="" /></a>
					</td>
					<td style="display:inline-block;">
					{% if object.certainty_info %}
						<a href="{% url 'cou_regulations' %}">
							<div class="square" style="width:20px; height: 20px; background-color: {% resolve_colour object.certainty_info %};border:1px solid #efefef;border-radius:2px;"></div>
						</a>
						<div class="info_on_hover" style="display:none;">{{ object.certainty_info }}</div>
					{% else %}
						<div class="square" style="width:20px;height:20px;background-color:none;border:1px solid #efefef;border-radius:2px;text-align:center;">C</div>
					{% endif %}				
					</td>
				</tr>
				{% block extra_sourceinfo %}{% endblock %}
			</table>
		</div>
		{% block related_noteinfo %}{% endblock %}
	{% block page_gallery %}
		<table id="sourcepage_overview">
		{% if coverimages %}
			{% if tracedimages %}
			<tr>
				<td>
					{{ counted_tracedimages|apnumber|title }} page{{ counted_tracedimages|pluralize }} with reading notes available below.
						{% if object.source_link %}
							<br/>
							For the complete book, please be referred <a href="{{ object.source_link }}" target="_blank" style="text-decoration:underline;">elsewhere</a>.
						{% endif %}
				</td>
			</tr>
			<tr>
				<td>
					<ul class="page_grid">
					{% for trace in tracedimages %}
						{% thumbnail trace.image "x100" as thum %}
						<li>
							<figure>
								<a href="{% url 'page_detail' slug=object.slug req_page=trace.actual_pagenumber %}" title="{{ trace.actual_pagenumber }}" class="hovertext" style="font-size:85%;">
									<img src="{{ thum.url }}" width="{{ thum.width }}" height="{{ thum.height }}">
								</a>
							</figure>
						</li>
						{% endthumbnail %}
					{% endfor %}
					</ul>
				</td>
			</tr>
			{% else %}
			<tr>
				<td style="line-height:30em;">
					{% if object.source_link %}
						Bibliographical information can be studied here. For the complete book, please be referred <a href="{{ object.source_link }}" target="_blank" style="text-decoration:underline;">elsewhere</a>.
					{% endif %}
				</td>
			</tr>
			{% endif %}
		{% endif %}
		</table>
	{% endblock %}
	</div>
	{% block detailed_content %}
	{% endblock %}
</div>
{% endblock %}