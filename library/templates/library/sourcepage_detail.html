{% extends 'library/library_dummy_base.html' %}
{% load thumbnail %}
{% load operations %}

{% block heads %}
<script src="{{ STATIC_URL }}library/js/scrollsneak.js"></script>
{% endblock %}

{% block source_pages %}
{% endblock %}

{% block content %}
<div class="panel panel-default">
	<div class="panel-body">
		<div class="media">
			{% if frontcover %}
		 	<div class="media-left">
				{% thumbnail frontcover "67x100" crop="98% 0%" as thum %}
				<img src="{{ thum.url }}" width="{{ thum.width }}" height="{{ thum.height }}">
		    	{% endthumbnail %}
		  	</div>
		 	{% endif %}
			<div class="media-body">
			    <h4 class="media-heading"><a class="notred" href="{% url 'source_detail' slug=sourceitem.slug %}">{{ sourceitem.title }}</a></h4>
			    	Page: {{ chosen_image.actual_pagenumber }}<br/>

			    	{% if found_excerpts %}
			    	<div class="media">
			  			<div class="media-left">
			  				<span class="glyphicon glyphicon-list-alt"></span>
			  			</div>
			  			<div class="media-body">
			    			<h4 class="media-heading">Reading traces</h4>
			    			<ol style="list-style:decimal;">
					    	{% for sourceexcerpt in found_excerpts %}
					    		<li><div class="excerpt {{ sourceexcerpt.place }}"><a class="notunderline" href="#">{{ sourceexcerpt.short|safe }}</a></div></li>
					    	{% endfor %}
					    	</ol>
					    </div>
					</div>
					{% endif %}
			</div>
		</div>
	</div>
</div>

</div>
<!-- page wrap closed and open gallery wrap -->
<div id="gallery" class="gallery-wrap">
	<div class="page-gallery">
		<div id="detail_page" class="detail_page">
			{% if chosen_image.image|is_portrait %}
				{% thumbnail chosen_image.image "1000x1500" upscale=False quality=100 as im %}
					<img id="source_page" alt="" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
					
					<table class="frame" width="{{ im.width }}" style="margin-left:{{ im.width|absSubtract:"1000"|divide:"2" }}px">
						<tr class="frame-top" height="{{ im.height|divide:"2" }}"><td id="frame-top-single" class="framelight frame-top-single">&nbsp;</td></tr>
						<tr class="frame-bottom" height="{{ im.height|divide:"2" }}"><td id="frame-bottom-single" class="framelight frame-bottom-single">&nbsp;</td></tr>
					</table>
				{% endthumbnail %}
			{% else %}
				{% thumbnail chosen_image.image "1000x1500" upscale=False quality=100 as im %}
					<img id="source_page" alt="" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
					<table class="frame" width="{{ im.width }}" style="margin-left:{{ im.width|absSubtract:"1000"|divide:"2" }}px">
						<tr class="frame-top" height="{{ im.height|divide:"2" }}"><td id="frame-top-left" class="framelight frame-top-left">&nbsp;</td><td id="frame-top-right" class="framelight frame-top-right">&nbsp;</td></tr>
						<tr class="frame-bottom" height="{{ im.height|divide:"2" }}"><td id="frame-bottom-left" class="framelight frame-bottom-left">&nbsp;</td><td id="frame-bottom-right" class="framelight frame-bottom-right">&nbsp;</td></tr>
					</table>
				{% endthumbnail %}
			{% endif %}
			{% for sourceexcerpt in found_excerpts %}
				<div class="excerptPopover excerpt {{ sourceexcerpt.place }}">
					<div class="panel panel-default">
						<div class="arrow"></div>
						<div class="panel-heading">Reading trace</div>
						<div class="panel-body">
							{{ sourceexcerpt.content|safe }}
						</div>	
						{% if sourceexcerpt.note_set %}
						<ul class="list-group">
				    		{% for note in sourceexcerpt.note_set.all %}
				    			<li class="list-group-item"><a class="notunderline" href="{% url 'notebookpage_detail' noteb=note.noteb notebpage=note.notepage %}">{{ note.short }}</a></li>
				    		{% endfor %}
				    	</ul>
				    	{% endif %}
		    		</div>
		    	</div>
	    	{% endfor %}
		</div>
		<div class="page-row-well well well-sm">

			{% if coverimages %}
				{% for cover in coverimages %}

					<div class="page-row">
					{% thumbnail cover.image "x100" as cover_thum %}
						<a href="{% url 'librarypage_detail' itemslug=sourceitem.slug req_page=cover.page_number %}" title="{{ cover.actual_pagenumber }}">
							<img class="thumbnail" src="{{ cover_thum.url }}" width="{{ cover_thum.width }}" height="{{ cover_thum.height }}">
						</a>
					{% endthumbnail %}
					</div>

				{% endfor %}
			{% endif %}

			{% if previous_image %}
				
					<div class="page-row">
					{% thumbnail previous_image.image "x100" as previous_thum %}
						<a href="{% url 'librarypage_detail' itemslug=sourceitem.slug req_page=previous_image.actual_pagenumber %}" title="{{ previous_image.actual_pagenumber }}">
							<img class="thumbnail" src="{{ previous_thum.url }}" width="{{ previous_thum.width }}" height="{{ previous_thum.height }}">
						</a>
					{% endthumbnail %}
					</div>
				
			{% endif %}
					<div class="page-row">
					{% thumbnail chosen_image.image "x100" as actual_thum %}
						<img class="thumbnail active" src="{{ actual_thum.url }}" width="{{ actual_thum.width }}" height="{{ actual_thum.height }}">
					{% endthumbnail %}
					</div>
			{% if next_image %}
				
					<div class="page-row">
					{% thumbnail next_image.image "x100" as next_thum %}
						<a href="{% url 'librarypage_detail' itemslug=sourceitem.slug req_page=next_image.actual_pagenumber %}" title="{{ next_image.actual_pagenumber }}" >
							<img class="thumbnail" src="{{ next_thum.url }}" width="{{ next_thum.width }}" height="{{ next_thum.height }}">
						</a>
					{% endthumbnail %}
					</div>
				
			{% endif %}
		</div>
	</div>
</div>
{% endblock %}

{% block finaljavascript %}
	{% if found_excerpts %}
<script type="text/javascript">
		$('[data-toggle="popover"]').popover({ html: true });
</script>
<script type="text/javascript">
	var framePosition;
	$(".excerpt").on("mouseover", function() {
		framePosition = $(this)[0].className.split(' ')[1];
		
		$(".frame-"+framePosition).css("visibility", "visible");
		
	}).on("mouseout", function() {
		$(".frame-"+framePosition).css("visibility", "hidden");
	});
</script>
	{% endif %}

<!-- <script>
(function() {
    var sneaky = new ScrollSneak(location.hostname), tabs = document.getElementById('tabs').getElementsByTagName('li'), i = 0, len = tabs.length;
    for (; i < len; i++) {
        tabs[i].onclick = sneaky.sneak;
    }
})();
</script>
 -->
 {% endblock %}